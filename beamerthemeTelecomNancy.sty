%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright (c) 2014, Adrien Krähenbühl <adrien.krahenbuhl@gmail.com>
% All rights reserved.
%
% Redistribution and use in source and binary forms, with or without modification,
% are permitted provided that the following conditions are met:
% 
% * Redistributions of source code must retain the above copyright notice, this
%   list of conditions and the following disclaimer.
% 
% * Redistributions in binary form must reproduce the above copyright notice, this
%   list of conditions and the following disclaimer in the documentation and/or
%   other materials provided with the distribution.
% 
% * Neither the name of Adrien Krähenbühl nor the names of its
%   contributors may be used to endorse or promote products derived from
%   this software without specific prior written permission.
% 
% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
% ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
% WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
% DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
% ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
% (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
% LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
% ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
% (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
% SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Main beamer theme file of the Telecom Nancy theme.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ProvidesPackage{beamerthemeTelecomNancy}[2014/01/31 Beamer theme for Telecom Nancy, v1.0]%

\RequirePackage{ifthen}%
\RequirePackage{xcolor}%

% -------------------------------------------------------------------------
% Options

% Affichage du plan sur deux colonnes
\newboolean{@usetoccolumns}%
\setboolean{@usetoccolumns}{false}%
\DeclareOptionBeamer{usetoccolumns}{\setboolean{@usetoccolumns}{true}}%

% Nombre de sections dans la première colonne
\def\tocnbsections{}
\DeclareOptionBeamer{tocnbsections}{\def\tocnbsections{#1}}%

% Affichage du plan à chaque section
\newboolean{@nosectiontoc}%
\setboolean{@nosectiontoc}{false}%
\DeclareOptionBeamer{nosectiontoc}{\setboolean{@nosectiontoc}{true}}%

% Ajouter de l'espace entre les sections du sommaire
\newboolean{@addsecspace}%
\setboolean{@addsecspace}{false}%
\DeclareOptionBeamer{addsecspace}{\setboolean{@addsecspace}{true}}%

% Ajouter de l'espace entre les sections du sommaire
\newboolean{@onlysecinheadline}%
\setboolean{@onlysecinheadline}{false}%
\DeclareOptionBeamer{onlysecinheadline}{\setboolean{@onlysecinheadline}{true}}%

% Affichage du logo sur toutes les slides
\newboolean{@nologoincontent}%
\setboolean{@nologoincontent}{false}%
\DeclareOptionBeamer{nologoincontent}{\setboolean{@nologoincontent}{true}}%

% Image des logos
\def\logo{}%
\def\logotoc{}%
\def\logocontent{}%
\DeclareOptionBeamer{logotoc}{\def\logotoc{#1}}%
\DeclareOptionBeamer{logocontent}{\def\logocontent{#1}}%
\DeclareOptionBeamer{logo}{\def\logo{#1}\ifx\logotoc\@empty\def\logotoc{#1}\fi\ifx\logocontent\@empty\def\logocontent{#1}\fi}%

% Taille du logo sur la première page
\def\logotitleheight{.15\paperheight}%
\DeclareOptionBeamer{logotitleheight}{\def\logotitleheight{#1}}%

% Taille du logo sur les sommaires
\def\logotocheight{.1\paperheight}%
\DeclareOptionBeamer{logotocheight}{\def\logotocheight{#1}}%

% Taille du logo sur les slides de contenu
\def\logocontentheight{.06\paperheight}%
\DeclareOptionBeamer{logocontentheight}{\def\logocontentheight{#1}}%


% Fond 1ere page
\def\backgroundtitlepage{}%
\DeclareOptionBeamer{backgroundtitlepage}{\def\backgroundtitlepage{#1}}%

% Fond derniere page
\def\backgroundlastpage{}%
\DeclareOptionBeamer{backgroundlastpage}{\def\backgroundlastpage{#1}}%

% Cacher la barre d'entete
\newboolean{@hideheadline}%
\setboolean{@hideheadline}{false}%
\DeclareOptionBeamer{hideheadline}{\setboolean{@hideheadline}{true}}%

% Couleur principale
\def\firstcolor{gray}%
\DeclareOptionBeamer{firstcolor}{\def\firstcolor{#1}}%

% Couleur secondaire
\def\secondcolor{red}%
\DeclareOptionBeamer{secondcolor}{\def\secondcolor{#1}}%

% Couleur secondaire
\def\thirdcolor{}%
\DeclareOptionBeamer{thirdcolor}{\def\thirdcolor{#1}}%

\ProcessOptionsBeamer%


% -------------------------------------------------------------------------

\mode<presentation>%

% -------------------------------------------------------------------------
% Tailles

\newlength{\slidemargin}%
\setlength{\slidemargin}{5mm}%

\newlength{\textmargin}%
\setlength{\textmargin}{2.\slidemargin}%

\newlength{\contentwidth}%
\setlength{\contentwidth}{\textwidth}%

\newlength{\slidewidth}%
\setlength{\slidewidth}{\textwidth}%
\addtolength{\slidewidth}{\textmargin}%

\setbeamersize{text margin left=\textmargin}%
\setbeamersize{text margin right=\textmargin}%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Couleurs

\setbeamercolor{palette primary}{fg=\firstcolor,bg=}
\setbeamercolor{palette secondary}{fg=white,bg=\firstcolor}%
\setbeamercolor{palette tertiary}{fg=\secondcolor,bg=}%
\setbeamercolor{palette quaternary}{fg=white,bg=\secondcolor}%

\setbeamercolor{title}{parent=palette secondary}%
\setbeamercolor{logoTitle}{parent=palette primary}%
\setbeamercolor{author}{parent=palette tertiary}%
\setbeamercolor{logointoc}{fg=,bg=white}%

\setbeamercolor{section in head/foot}{parent=palette secondary}%
\setbeamercolor{author in head/foot}{parent=palette tertiary}%
\setbeamercolor{date in head/foot}{parent=palette secondary}%

\setbeamercolor{frametitle in toc}{parent=palette quaternary}%
\setbeamercolor{section in toc}{parent=palette quaternary}%
\setbeamercolor{section in toc shaded}{parent=palette primary}%
\setbeamercolor{subsection in toc}{parent=palette quaternary}%
\setbeamercolor{subsection in toc shaded}{parent=palette primary}%

\setbeamercolor{frametitle}{parent=palette primary}%
\setbeamercolor{block title}{parent=palette secondary}%
\setbeamercolor{block title example}{parent=palette secondary}%
\setbeamercolor{block title alerted}{parent=palette secondary}%
\setbeamercolor{block body alerted}{parent=palette secondary}%
\setbeamercolor{alerted text}{parent=palette primary}%

\setbeamercolor{item}{parent=palette tertiary}%

% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Template des slides

\setbeamertemplate{navigation symbols}{}%
\setbeamertemplate{title page}%
{%
	\hfill%
	\newlength{\logotitlewidth}\setlength{\logotitlewidth}{\logotitleheight}\addtolength{\logotitlewidth}{.05\paperheight}%
	\begin{beamercolorbox}[wd=\logotitlewidth,ht=\logotitleheight,sep=0em,dp=0em,colsep=0em,colsep*=0em,center]{logoTitle}%
		\includegraphics[height=\logotitleheight]{\logo}%
	\end{beamercolorbox}\hspace{.1\textwidth}~\\[1em]
	\hfill%
	\begin{beamercolorbox}[wd=.9\textwidth,sep=.7em,dp=0em,colsep=0em,colsep*=0em,center,rounded=true,shadow=true]{title}%
		\bfseries%
		\usebeamerfont{title}\inserttitle \\[.5em]
		\usebeamerfont{subtitle}\textit{\insertsubtitle}%
	\end{beamercolorbox}
	\hfill~\\[2.5em]
	\hfill%
	\begin{beamercolorbox}[sep=.5em,center,rounded=true,wd=\textwidth,ignorebg]{author}%
		\bfseries%
		\usebeamerfont{author}\insertauthor\\%
		\usebeamerfont{institute}\insertinstitute \\[1em]%
		\usebeamerfont{date}\insertdate\\[.2em]%
	\end{beamercolorbox}%
	\hfill~\\
\vspace{3em}
}

\setbeamertemplate{headline}%
{%
	\ifthenelse{\boolean{@hideheadline}}{}%
	{%
		\hspace{\slidemargin}%
		\vbox%
		{%
			\vspace{-1.1em}%
			\begin{beamercolorbox}[wd=\slidewidth,ht=1.1em,dp=0em,center,shadow=true,rounded=true]{section in head/foot}%
				\ifthenelse{\boolean{@onlysecinheadline}}{%
					\insertsectionnavigationhorizontal{1.05\contentwidth}{\hfill\bfseries}{\hfill}%
				}{%
					\insertsubsectionnavigationhorizontal{1.05\contentwidth}{\insertsectionnumber. \insertsectionhead \hfill}{\hfill}%
				}%
			\end{beamercolorbox}%
		}%
	}%
}

\setbeamertemplate{frametitle}%
{%
	\begin{beamercolorbox}[wd=\slidewidth,ht=1.1em,dt=0em,ignorebg]{frametitle}%
		\bfseries \insertframetitle%
	\end{beamercolorbox}%
}

\setbeamertemplate{footline}%
{%
	\hbox%
	{%
		\hspace{2\slidemargin}%
		\begin{beamercolorbox}[wd=0.9\slidewidth,ht=1.1em,dp=0.4em,center]{author in head/foot}%
			\textit{\insertshorttitle} % \quad -- \quad \textit{\insertshortauthor}%
		\end{beamercolorbox}%
		\vbox{%
			\begin{beamercolorbox}[wd=.05\textwidth,ht=1em,colsep=0em,center,rounded=true,shadow=true]{date in head/foot}%
				\vspace{.2em}\insertframenumber{}/\inserttotalframenumber%
			\end{beamercolorbox}%
			\vspace{-1em}%
		}%
	}%
}%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Listes

\setbeamertemplate{itemize item}{\tiny $\bullet$}%
\setbeamertemplate{description item}{{\bf \insertdescriptionitem}}%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Blocks

\setbeamertemplate{blocks}[rounded][shadow]%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Emph

\ifx\thirdcolor\@empty%
	\renewcommand{\emph}[1]{\textbf{\color{\firstcolor}{#1}}}%
\else%
	\renewcommand{\emph}[1]{\textbf{\color{\thirdcolor}{#1}}}%
\fi%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Sommaire

\setbeamerfont{section in toc}{series=\bfseries,size=\Huge}
\setbeamerfont{section in toc shaded}{series=\mdseries,size=\Large}
\setbeamerfont{subsection in toc}{series=\bfseries,size=\normalfont}
\setbeamerfont{subsection in toc shaded}{series=\mdseries}
\ifthenelse{\boolean{@addsecspace}}
{%
	\setbeamertemplate{section in toc}{\vskip1em{{\inserttocsectionnumber.} \inserttocsection}}%
}{%
	\setbeamertemplate{section in toc}{%
		\begin{beamercolorbox}[wd=\slidewidth,ht=1.1em,dp=0.4em,center]{palette quaternary}%
			\inserttocsection%
		\end{beamercolorbox}%
	}%
	\setbeamertemplate{section in toc shaded}{%
		\begin{beamercolorbox}[wd=\slidewidth,ht=1em,dp=0.4em,center]{palette quaternary}%
			\inserttocsection%
		\end{beamercolorbox}%
	}%
	\setbeamertemplate{subsection in toc}{%
		\begin{beamercolorbox}[wd=\slidewidth,ht=1em,dp=0em,center]{palette quaternary}%
			\inserttocsubsection%
		\end{beamercolorbox}%
	}%
}%

\newcommand{\frametitleintoc}
{
	\frametitle{%
		\vspace{-2em}%
		\begin{beamercolorbox}[wd=\slidewidth,center,rounded=true]{frametitle in toc}%
			\centering {\LARGE \bfseries Plan}%
		\end{beamercolorbox}%
	}%
}

\ifthenelse{\boolean{@usetoccolumns}}
{%
	% Counter
	\newcounter{tocsecondcolumnstart}%
	\setcounter{tocsecondcolumnstart}{\tocnbsections}%
	\addtocounter{tocsecondcolumnstart}{1}%
	% Command
	\newcommand{\toccontent}[1]{%
		\frametitleintoc%
		\begin{columns}[t]%
			\begin{column}{0.4\textwidth}%
				\tableofcontents[sections={1-\tocnbsections},#1]%
			\end{column}%
			\begin{column}{0.4\textwidth}%
				\tableofcontents[sections={\thetocsecondcolumnstart-},#1]%
			\end{column}%
		\end{columns}%
	}%
}{%
	\newcommand{\toccontent}[1]{%
		\tableofcontents[#1,hideallsubsections]%
	}%
}%

\newcommand{\tocfullcontent}{\toccontent{}}
\newcommand{\tocsectioncontent}{\toccontent{currentsection}}

\newlength{\logotocwidth}\setlength{\logotocwidth}{\logotocheight}\addtolength{\logotocwidth}{2em}
\newlength{\logotocfullheight}\setlength{\logotocfullheight}{\logotocheight}\addtolength{\logotocfullheight}{.03\paperheight}

\ifthenelse{\boolean{@nosectiontoc}}{}%
{%
	\AtBeginSection[]
	{%
		{%
			\setbeamertemplate{background canvas}[default]%
			\setbeamercolor{background canvas}{parent=palette quaternary}%
			\begin{frame}[plain,noframenumbering]%
				\vfill
				\tocsectioncontent%
				\vfill
				\hfill%
				\begin{beamercolorbox}[wd=\logotocwidth,ht=\logotocfullheight,sep=0em,dp=0em,colsep=0em,colsep*=0em,center,rounded=true]{logointoc}
					\includegraphics[height=\logotocheight]{\logotoc}\\[.03\paperheight]
				\end{beamercolorbox}%
				\hfill~\\[-.12\paperheight]
			\end{frame}%
		}%
	}%
}%

\newcommand{\sectionslide}[1]%
{%
	{%
		\setbeamertemplate{background canvas}[default]%
		\setbeamercolor{background canvas}{parent=palette quaternary}%
		\begin{frame}[plain,noframenumbering]%
			\begin{center}%
				\bfseries \Huge \color{white} #1%
			\end{center}%
		\end{frame}%
	}%
}

\newcommand{\subsectionslide}[1]%
{%
	{%
		\setbeamertemplate{background canvas}[default]%
		\setbeamercolor{background canvas}{parent=palette quaternary}%
		\begin{frame}[plain,noframenumbering]%
			\vspace{.357\textheight}
			\begin{center}%
				\bfseries \itshape \Large \color{white} #1%
			\end{center}%
			\vspace{.357\textheight}
			\hfill%
			\begin{beamercolorbox}[wd=\logotocwidth,ht=\logotocfullheight,sep=0em,dp=0em,colsep=0em,colsep*=0em,center,rounded=true]{logointoc}
				\includegraphics[height=\logotocheight]{\logotoc}\\[.03\paperheight]
			\end{beamercolorbox}%
			\hfill~\\[-.12\paperheight]
		\end{frame}%
	}%
}

\newcommand{\lastslide}[1]%
{%
	\ifx\backgroundlastpage\@empty%
		\setbeamertemplate{background canvas}{}%
	\else%
		\setbeamertemplate{background canvas}{\includegraphics[width=\paperwidth,height=\paperheight]{\backgroundlastpage}}%
	\fi%
	\begin{frame}[plain,noframenumbering]%
		\vspace{.75\paperheight}%
		\hfill%
		\begin{beamercolorbox}[wd=.35\paperwidth,sep=.5em,center,rounded=false]{title}%
			\bfseries%
			\usebeamerfont{title}#1%
			\vspace{-.1em}%
		\end{beamercolorbox}%
	\end{frame}%
	\setbeamertemplate{background canvas}{}
}

% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Arrière plan et logo

\setbeamertemplate{background canvas}{%
	\ifnum\c@framenumber=1%
		\ifx\backgroundtitlepage\@empty%
		\else%
			\includegraphics[width=\paperwidth,height=\paperheight]{\backgroundtitlepage}%
		\fi%
	\else%
		\ifthenelse{\boolean{@nologoincontent}}{}%
			{\begin{picture}(0,0)\put(5,-270){\includegraphics[height=\logocontentheight]{\logocontent}}\end{picture}}%
	\fi%
}
% -------------------------------------------------------------------------

\mode<all>