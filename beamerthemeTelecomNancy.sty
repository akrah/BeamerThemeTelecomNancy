%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright (c) 2014, Adrien Krähenbühl <adrien.krahenbuhl@gmail.com>
% All rights reserved.
%
% Redistribution and use in source and binary forms, with or without modification,
% are permitted provided that the following conditions are met:
% 
% * Redistributions of source code must retain the above copyright notice, this
%   list of conditions and the following disclaimer.
% 
% * Redistributions in binary form must reproduce the above copyright notice, this
%   list of conditions and the following disclaimer in the documentation and/or
%   other materials provided with the distribution.
% 
% * Neither the name of Adrien Krähenbühl nor the names of its
%   contributors may be used to endorse or promote products derived from
%   this software without specific prior written permission.
% 
% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
% ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
% WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
% DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
% ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
% (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
% LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
% ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
% (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
% SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Main beamer theme file of the Telecom Nancy theme.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ProvidesPackage{beamerthemeTelecomNancy}[2014/01/31 Beamer theme for Telecom Nancy, v1.0]%

\RequirePackage{ifthen}%
\RequirePackage{xcolor}%

% -------------------------------------------------------------------------
% Options

% Affichage du plan à chaque section
\newboolean{@nosectiontoc}%
\setboolean{@nosectiontoc}{false}%
\DeclareOptionBeamer{nosectiontoc}{\setboolean{@nosectiontoc}{true}}%

% Ajouter de l'espace entre les sections du sommaire
\newboolean{@onlysecinheadline}%
\setboolean{@onlysecinheadline}{false}%
\DeclareOptionBeamer{onlysecinheadline}{\setboolean{@onlysecinheadline}{true}}%

% Image du logo
\def\logo{}%
\DeclareOptionBeamer{logo}{\def\logo{#1}}%

% Taille du logo
\def\logoheight{}%
\DeclareOptionBeamer{logoheight}{\def\logoheight{#1}}%

% Fond 1ere page
\def\backgroundtitlepage{}%
\DeclareOptionBeamer{backgroundtitlepage}{\def\backgroundtitlepage{#1}}%

% Fond derniere page
\def\backgroundlastpage{}%
\DeclareOptionBeamer{backgroundlastpage}{\def\backgroundlastpage{#1}}%

% Cacher la barre d'entete
\newboolean{@hideheadline}%
\setboolean{@hideheadline}{false}%
\DeclareOptionBeamer{hideheadline}{\setboolean{@hideheadline}{true}}%

% Couleur principale
\def\firstcolor{gray}%
\DeclareOptionBeamer{firstcolor}{\def\firstcolor{#1}}%

% Couleur secondaire
\def\secondcolor{red}%
\DeclareOptionBeamer{secondcolor}{\def\secondcolor{#1}}%

\ProcessOptionsBeamer%

% -------------------------------------------------------------------------

\mode<presentation>%

% -------------------------------------------------------------------------
% Tailles

\newlength{\slidemargin}%
\setlength{\slidemargin}{5mm}%

\newlength{\textmargin}%
\setlength{\textmargin}{2.\slidemargin}%

\newlength{\contentwidth}%
\setlength{\contentwidth}{\textwidth}%

\newlength{\slidewidth}%
\setlength{\slidewidth}{\textwidth}%
\addtolength{\slidewidth}{\textmargin}%

\setbeamersize{text margin left=\textmargin}%
\setbeamersize{text margin right=\textmargin}%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Couleurs

\setbeamercolor{palette primary}{fg=\firstcolor,bg=}
\setbeamercolor{palette secondary}{fg=white,bg=\firstcolor}%
\setbeamercolor{palette tertiary}{fg=\secondcolor,bg=}%
\setbeamercolor{palette quaternary}{fg=white,bg=\secondcolor}%

\setbeamercolor{title}{parent=palette secondary}%

\setbeamercolor{section in head/foot}{parent=palette secondary}%
\setbeamercolor{author in head/foot}{parent=palette primary}%
\setbeamercolor{date in head/foot}{parent=palette secondary}%

\setbeamercolor{frametitle in toc}{parent=palette quaternary}%
\setbeamercolor{section in toc}{parent=palette quaternary}%
\setbeamercolor{section in toc shaded}{parent=palette primary}%
\setbeamercolor{subsection in toc}{parent=palette quaternary}%
\setbeamercolor{subsection in toc shaded}{parent=palette primary}%

\setbeamercolor{frametitle}{parent=palette primary}%
\setbeamercolor{block title}{parent=palette secondary}%
\setbeamercolor{block title example}{parent=palette secondary}%
\setbeamercolor{block title alerted}{parent=palette secondary}%
\setbeamercolor{block body alerted}{parent=palette secondary}%
\setbeamercolor{alerted text}{parent=palette primary}%

\setbeamercolor{item}{parent=palette tertiary}%

% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Template des slides

\setbeamertemplate{navigation symbols}{}%
\setbeamertemplate{title page}[default][sep=0.5em,rounded=true,shadow=true]%

\setbeamertemplate{headline}%
{%
	\ifthenelse{\boolean{@hideheadline}}{}%
	{%
		\hspace{\slidemargin}%
		\vbox%
		{%
			\vspace{-1.1em}%
			\begin{beamercolorbox}[wd=\slidewidth,ht=1.1em,dp=0em,center,shadow=true,rounded=true]{section in head/foot}%
				\ifthenelse{\boolean{@onlysecinheadline}}{%
					\insertsectionnavigationhorizontal{1.05\contentwidth}{\hfill\bfseries}{\hfill}%
				}{%
					\insertsubsectionnavigationhorizontal{1.05\contentwidth}{\insertsectionnumber. \insertsectionhead \hfill}{\hfill}%
				}%
			\end{beamercolorbox}%
		}%
	}%
}

\setbeamertemplate{frametitle}%
{%
	\begin{beamercolorbox}[wd=\slidewidth,ht=1.1em,dt=0em,ignorebg]{frametitle}%
		\bfseries \insertframetitle%
	\end{beamercolorbox}%
}

\setbeamertemplate{footline}%
{%
	\hbox%
	{%
		\hspace{2\slidemargin}%
		\begin{beamercolorbox}[wd=0.9\slidewidth,ht=1.1em,dp=0.4em,center]{author in head/foot}%
			\textit{\insertshorttitle} \quad -- \quad \textit{\insertshortauthor}%
		\end{beamercolorbox}%
		\vbox{%
			\begin{beamercolorbox}[wd=.05\textwidth,ht=1em,colsep=0em,center,rounded=true,shadow=true]{date in head/foot}%
				\vspace{.2em}\insertframenumber{}/\inserttotalframenumber%
			\end{beamercolorbox}%
			\vspace{-1em}%
		}%
	}%
}%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Listes

\setbeamertemplate{itemize item}{\tiny $\bullet$}%
\setbeamertemplate{description item}{{\bf \insertdescriptionitem}}%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Blocks

\setbeamertemplate{blocks}[rounded][shadow]%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Emph

\renewcommand{\emph}[1]{\textbf{\color{\secondcolor}{#1}}}%
% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Sommaire

\setbeamerfont{section in toc}{series=\bfseries,size=\Huge}
\setbeamerfont{section in toc shaded}{series=\mdseries,size=\Large}
\setbeamerfont{subsection in toc}{series=\bfseries,size=\normalfont}
\setbeamerfont{subsection in toc shaded}{series=\mdseries}
\setbeamertemplate{section in toc}{%
	\begin{beamercolorbox}[wd=\slidewidth,ht=1em,dp=0.4em,center]{palette quaternary}%
		\inserttocsection%
	\end{beamercolorbox}%
}%
\setbeamertemplate{section in toc shaded}{%
	\begin{beamercolorbox}[wd=\slidewidth,ht=1em,dp=0.4em,center]{palette quaternary}%
		\inserttocsection%
	\end{beamercolorbox}%
}%
\setbeamertemplate{subsection in toc}{%
	\begin{beamercolorbox}[wd=\slidewidth,ht=1em,dp=0em,center]{palette quaternary}%
		\inserttocsubsection%
	\end{beamercolorbox}%
}%

\newcommand{\frametitleintoc}
{
	\frametitle{%
		\vspace{-2em}%
		\begin{beamercolorbox}[wd=\slidewidth,center,rounded=true]{frametitle in toc}%
			\centering {\LARGE \bfseries Plan}%
		\end{beamercolorbox}%
	}%
}

\newcommand{\toccontent}[1]{\tableofcontents[#1,hideallsubsections]}%
\newcommand{\tocfullcontent}{\toccontent{sectionstyle=shaded/shaded}}
\newcommand{\tocsectioncontent}{\toccontent{currentsection}}

\newcommand{\tocslide}
{%
	{%
		\setbeamertemplate{background canvas}[default]%
		\setbeamercolor{background canvas}{parent=palette quaternary}%
		\begin{frame}[plain,noframenumbering]%
			\vfill%
			\tocfullcontent%
			\vfill%
		\end{frame}%
	}%
}

\ifthenelse{\boolean{@nosectiontoc}}{}%
{%
	\AtBeginSection[]
	{%
		{%
			\setbeamertemplate{background canvas}[default]%
			\setbeamercolor{background canvas}{parent=palette quaternary}%
			\begin{frame}[plain,noframenumbering]%
				\vfill%
				\tocsectioncontent%
				\vfill%
			\end{frame}%
		}%
	}%
}%

\newcommand{\sectionslide}%
{%
	{%
		\setbeamertemplate{background canvas}[default]%
		\setbeamercolor{background canvas}{parent=palette quaternary}%
		\begin{frame}[plain,noframenumbering]%
			\vfill%
			\tableofcontents[sectionstyle=show/hide]%
			\vfill%
		\end{frame}%
	}%
}

\newcommand{\subsectionslide}%
{%
	{%
		\setbeamertemplate{background canvas}[default]%
		\setbeamercolor{background canvas}{parent=palette quaternary}%
		\begin{frame}[plain,noframenumbering]%
			\vfill%
			\tableofcontents[currentsubsection,
				sectionstyle=hide/hide,
				subsectionstyle=shaded/hide/hide]%
			\vfill%
		\end{frame}%
	}%
}

\newcommand{\subsectionslidecustom}[1]%
{%
	{%
		\setbeamertemplate{background canvas}[default]%
		\setbeamercolor{background canvas}{parent=palette quaternary}%
		\begin{frame}[plain,noframenumbering]%
			\vfill%
			\color{white} \bfseries \begin{center}#1\end{center}
			\vfill%
		\end{frame}%
	}%
}

\newcommand{\lastslide}[1]%
{%
	\setbeamertemplate{background canvas}{\includegraphics[width=\paperwidth,height=\paperheight]{\backgroundlastpage}}
	\begin{frame}[plain,noframenumbering]%
		\vfill%
		\begin{beamercolorbox}[wd=.35\paperwidth,sep=.5em,center,rounded=false]{title}%
			\bfseries%
			\usebeamerfont{title}#1%
		\end{beamercolorbox}%
	\end{frame}%
	\setbeamertemplate{background canvas}{}
}

% -------------------------------------------------------------------------



% -------------------------------------------------------------------------
% Arrière plan et logo

\setbeamertemplate{background canvas}{%
	\ifnum\c@framenumber=1%
		\ifx\backgroundtitlepage\@empty%
		\else%
			\includegraphics[width=\paperwidth,height=\paperheight]{\backgroundtitlepage}%
		\fi%
	\else%
		\ifx\logo\@empty%
		\else%
			\ifx\logoheight\@empty%
				\begin{picture}(0,0)\put(5,-270){\includegraphics[height=0.06\paperheight]{\logo}}\end{picture}
			\else%
				\begin{picture}(0,0)\put(5,-270){\includegraphics[height=\logoheight]{\logo}}\end{picture}
			\fi%
		\fi%
	\fi%
}
% -------------------------------------------------------------------------

\mode<all>